import{_ as w,h as g,c as E,o as O,G as j,Y as $,Z as A,O as _,r as p,e as F,x as J,f as Y,N as k,A as y}from"./D0vcV0aY.js";import{c as B}from"./CrMNIAvO.js";class f extends Error{constructor(r){super(r),this.message=r,Object.setPrototypeOf(this,f.prototype)}}const P=g({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:r,emit:a}){const l=k(),s=B(`form-${l}`),u=p(null);F(()=>{s.on(async t=>{t.type!=="submit"&&e.validateOn?.includes(t.type)&&await d(t.path,{silent:!0})})}),J(()=>{s.reset()});const n=p([]);y("form-errors",n),y("form-events",s);const h=p({});y("form-inputs",h);async function S(){let t=await e.validate(e.state);if(e.schema){const{errors:o,result:i}=await V(e.state,e.schema);o?t=t.concat(o):u.value=i}return t}async function d(t,o={silent:!1}){let i=t;if(t&&!Array.isArray(t)&&(i=[t]),i){const v=n.value.filter(m=>!i.includes(m.path)),c=(await S()).filter(m=>i.includes(m.path));n.value=v.concat(c)}else n.value=await S();if(n.value.length>0){if(o.silent)return!1;throw new f(`Form validation failed: ${JSON.stringify(n.value,null,2)}`)}return e.state}async function b(t){const o=t;try{e.validateOn?.includes("submit")&&await d(),o.data=e.schema?u.value:e.state,a("submit",o)}catch(i){if(!(i instanceof f))throw i;const v={...o,errors:n.value.map(c=>({...c,id:h.value[c.path]}))};a("error",v)}}return r({validate:d,errors:n,setErrors(t,o){o?n.value=n.value.filter(i=>i.path!==o).concat(t):n.value=t},async submit(){await b(new Event("submit"))},getErrors(t){return t?n.value.filter(o=>o.path===t):n.value},clear(t){t?n.value=n.value.filter(o=>o.path!==t):n.value=[]}}),{onSubmit:b,errors:Y(n)}}});function I(e){return e.validate&&e.__isYupSchema__}function M(e){return e.inner!==void 0}function N(e){return"schema"in e&&typeof e.coercer=="function"&&typeof e.validator=="function"&&typeof e.refiner=="function"}function U(e){return e.validateAsync!==void 0&&e.id!==void 0}function q(e){return e.isJoi===!0}function x(e){return"~standard"in e}async function z(e,r){const a=await r["~standard"].validate(e);return!a.issues||a.issues.length===0?{errors:null,result:"value"in a?a.value:null}:{errors:a.issues.map(s=>({path:s.path?.map(u=>typeof u=="object"?u.key:u).join(".")||"",message:s.message})),result:null}}async function C(e,r){try{return{errors:null,result:await r.validateAsync(e,{abortEarly:!1})}}catch(a){if(q(a))return{errors:a.details.map(s=>({path:s.path.join("."),message:s.message})),result:null};throw a}}async function G(e,r){const[a,l]=r.validate(e);return a?{errors:a.failures().map(u=>({message:u.message,path:u.path.join(".")})),result:null}:{errors:null,result:l}}async function R(e,r){try{return{errors:null,result:await r.validate(e,{abortEarly:!1})}}catch(a){if(M(a))return{errors:a.inner.map(s=>({path:s.path??"",message:s.message})),result:null};throw a}}function V(e,r){if(x(r))return z(e,r);if(U(r))return C(e,r);if(I(r))return R(e,r);if(N(r))return G(e,r);throw new Error("Form validation failed: Unsupported form schema")}function Z(e,r,a,l,s,u){return O(),E("form",{onSubmit:r[0]||(r[0]=_((...n)=>e.onSubmit&&e.onSubmit(...n),["prevent"]))},[j(e.$slots,"default",$(A({errors:e.errors})))],32)}const K=w(P,[["render",Z]]);export{K as default,x as isStandardSchema,z as validateStandardSchema};
